---
title: Use Ipopt
layout: post
guid: urn:uuid:c3e4cc4f-a019-4ef0-97c5-05a54a2746b2
categories:
  - unix
tags:
  - Ipopt
  - Linux
---

> This note shows a successful use of [Ipopt](https://coin-or.github.io/Ipopt/index.html) on Linux.

{% include lib/mathjax.html %}

* TOC
{:toc}


----------------------------------------------
----------------------------------------------


### [Shared Libraries](http://tldp.org/HOWTO/Program-Library-HOWTO/shared-libraries.html)

#### Conventions
{:.no_toc}

##### Shared Library Names
{:.no_toc}

Take the example of blas libraries
```
    update-alternatives --display libblas.so
    # link currently points to /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.7.1

    ll /etc/alternatives/libblas.so
    # /etc/alternatives/libblas.so -> /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.7.1
    ll /usr/lib/x86_64-linux-gnu/blas
    # libblas.so -> libblas.so.3.7.1
    # libblas.so.3 -> libblas.so.3.7.1
    # libblas.so.3.7.1
    ll /usr/lib/libblas.so
    # /usr/lib/libblas.so -> /etc/alternatives/libblas.so 
    # libblas.so is installed in /usr/lib
```

- The *soname* has the prefix _lib_, the name of the library, the phrase _.so_, followed by a period and a version number. A fully-qualified soname includes as a prefix the directory it's in, */usr/lib/x86_64-linux-gnu/blas/libblas.so.3* in this case.
- The *real name* contains the actual library code, it adds to the soname a period, a minor number, another period, and the release number (optional). */usr/lib/x86_64-linux-gnu/blas/libblas.so.3.7.1* in this case.
- The *linker name* is the name that the compiler uses when requesting a library, */usr/lib/libblas.so* in this case.

##### Filesystem Placement
{:.no_toc}

The GNU standards recommend installing by default all libraries in */usr/local/lib* when distributing source code (and all commands should go into */usr/local/bin*).
According to the FHS, most libraries should be installed in */usr/lib*, but libraries required for startup should be in */lib* and libraries that are not part of the system should be in */usr/local/lib*.

There isn't really a conflict between these two documents; the GNU standards recommend the default for developers of source code, while the FHS recommends the default for distributors (who selectively override the source code defaults, usually via the system's package management system).

#### How Libraries are Used
{:.no_toc}

On GNU glibc-based systems, including all Linux systems, starting up an ELF (Executable and Linking Format) binary executable automatically causes the program loader to be loaded and run. 
On Linux systems, this loader is named */lib/ld-linux.so.X* (where *X* is a version number). This loader, in turn, finds and loads all other shared libraries used by the program.
The list of directories to be searched is stored in the file */etc/ld.so.conf*.

If you want to just override a few functions in a library, but keep the rest of the library, you can enter the names of overriding libraries (*.o* files) in */etc/ld.so.preload*; these *preloading* libraries will take precedence over the standard set. 
This preloading file is typically used for emergency patches; a distribution usually won't include such a file when delivered.

Searching all of these directories at program start-up would be grossly inefficient, so a caching arrangement is actually used. The program *ldconfig(8)* by default reads in the file */etc/ld.so.conf*, 
sets up the appropriate symbolic links in the dynamic link directories (so they'll follow the standard conventions), and then writes a cache to */etc/ld.so.cache* that's then used by other programs. 
This greatly speeds up access to libraries. The implication is that *ldconfig* must be run whenever a DLL (dynamically linked library) is added, when a DLL is removed, or when the set of DLL directories changes; 
running *ldconfig* is often one of the steps performed by package managers when installing a library. On start-up, then, the dynamic loader actually uses the file */etc/ld.so.cache* and then loads the libraries it needs.

#### Environment Variables
{:.no_toc}

Various environment variables can control this process, and there are environment variables that permit you to override this process.

##### LD\_LIBRARY\_PATH
{:.no_toc}

You can temporarily substitute a different library for this particular execution. In Linux, the environment variable LD\_LIBRARY\_PATH is a colon-separated set of directories where libraries should be searched for first, 
before the standard set of directories; this is useful when debugging a new library or using a nonstandard library for special purposes. The environment variable LD\_PRELOAD lists shared libraries with functions that override the standard set, 
just as */etc/ld.so.preload* does. These are implemented by the loader */lib/ld-linux.so*.

LD\_LIBRARY\_PATH is handy for development and testing, but shouldn't be modified by an installation process for normal use by normal users. If you don't want to set the LD\_LIBRARY\_PATH environment variable, 
on Linux you can even invoke the program loader directly and pass it arguments. For example, the following will use the given PATH instead of the content of the environment variable LD\_LIBRARY\_PATH, and run the given executable:

```
    /lib/ld-linux.so.2 --library-path PATH EXECUTABLE
```

Just executing ld-linux.so without arguments will give you more help on using this, but again, don't use this for normal use - these are all intended for debugging.


### [If the libA is installed?](https://www.ostechnix.com/how-to-find-if-a-package-is-installed-or-not-in-linux-and-unix/)

How to check if a library is installed or not even if I don't know the exact name? On Ubuntu, one can use 
```
    # fix library full name
    dpkg --list | grep -i blas
    # ii  libblas-dev:amd64                             3.7.1-4ubuntu1                                  amd64        Basic Linear Algebra Subroutines 3, static library
    # ii  libblas3:amd64                                3.7.1-4ubuntu1                                  amd64        Basic Linear Algebra Reference implementations, shared library
    # ii  libopenblas-base:amd64                        0.2.20+ds-4                                     amd64        Optimized BLAS (linear algebra) library (shared library)

    # show library full info
    dpkg -s libopenblas-base

    # locate the library
    dpkg -L libopenblas-base
```
for example, to check if the BLAS library is installed.

### Manage multiple blas with [update-alternatives](https://damien.clauzel.eu/post/2005/02/12/Tutoriel-pour-update-alternatives)

For example, there are two versions of shared blas libraries in my Ubuntu, as shown above, *libblas-dev* and *libopenblas-base*.
*update-alternatives* can be used to maintain these different realizations of blas.

```
    # To check if libblas.so already exists
    update-alternatives --list libblas.so

    # Install a new alternative for libblas.so
    # update-alternatives --install <link> <name> <path> <priority>
    sudo update-alternatives --install /usr/lib/libblas.so libblas.so /usr/lib/x86_64-linux-gnu/blas/libblas.so 1000
    sudo update-alternatives --install /usr/lib/libblas.so libblas.so /usr/lib/x86_64-linux-gnu/openblas/libblas.so.3 1010

    # show current installed alternatives
    update-alternatives --display libblas.so
    # show in etc
    ls /etc/alternatives | grep libblas

    # change the current link point to lib
    sudo update-alternatives --config libblas.so
    # or switch to the highest priority installed alternatives
    sudo update-alternatives --auto libblas.so

    # remove an alternative 
    sudo update-alternatives --remove libblas.so /usr/lib/x86_64-linux-gnu/blas/libblas.so

    # use libblas.so
    g++ pardiso_sym.cpp -o pardiso_sym -L/usr/local/lib -lpardiso600-GNU720-X86-64 -L/usr/lib -lblas -llapack -lgfortran -fopenmp -lpthread -lm
```
