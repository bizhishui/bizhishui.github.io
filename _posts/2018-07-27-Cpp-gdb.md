---
title: Debug C++ codes with gdb
layout: post
guid: urn:uuid:73029be0-5b10-4b20-a715-33cca652cbd6
summary: Notes in debuging C++ code with GDN are listed here.
categories:
  - notes
tags:
  - Linux
  - C++
  - gdb
---

As there are many tutorials can be found online, like [this one](http://www.math.bas.bg/~nkirov/2005/netb151/debugging-with-gdb.html), 
here I'm not going to list all usages or options of gdb, but just some techniques used during my debugs.

### Program with command line arguments
For a code need supply command line arguments, the gdb debug command is

```
    gdb --args executable arg1 arg2 ... argn
```

For example, an executable code named *foo* takes a file *input* as argument (contains all parameters needed by *foo*),

```
    gdb --args foo input
```

### Debugging a crashed program
When your program is crashed, a segmentation fault, for example. Using the [*core dump*](https://jvns.ca/blog/2018/04/28/debugging-a-segfault-on-linux/) will be very helpful in 
locating the causes. The basic [steps](https://stackoverflow.com/questions/7647298/segmentation-fault-when-running-but-success-when-debugging) are,

- type *ulimit -c unlimited* in an xterm (this allows the creation of core/postmorterm files)
- launch your program (and let it crash): a core file should now be present in the directory
- launch the debugger with *gdb yourprogram corefile*
- type *bt* at gdb prompt to see on what line it did crash
- type *frame framenumber* to select a particular frame, and get more info
- use *list* to show the code around this frame, and *info locals* to see the local variables and *print variable* to show its value

Here is an example,

```
    (bash) ulimit -c unlimited
    (bash) Soft2D input
    (bash) gdb Soft2d core
    [Thread debugging using libthread_db enabled]
    Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
    Core was generated by `Soft2D input'.
    Program terminated with signal SIGSEGV, Segmentation fault.
    #0  __GI___libc_free (mem=0x3fd00e6251f20673) at malloc.c:2951
    2951	malloc.c: No such file or directory.
    [Current thread is 1 (Thread 0x7f09e39357c0 (LWP 1057))]
    (gdb) bt
    #0  __GI___libc_free (mem=0x3fd00e6251f20673) at malloc.c:2951
    #1  0x0000000000408f87 in myarray<double>::~myarray (this=0x7ffe173923f0, __in_chrg=<optimized out>) at src/../include/myarray.h:240
    #2  0x00000000004081a1 in geometry::computeCurvesGeoProperties (this=0x651888 <run_input+136>) at src/geometry.cpp:179
    #3  0x0000000000403ea6 in input::setup (this=0x651800 <run_input>, fileNameC=0x7ffe17394f84 "input") at src/input.cpp:107
    #4  0x0000000000402be2 in main (argc=2, argv=0x7ffe17392d08) at src/main.cpp:45
    (gdb) fram 1
    #1  0x0000000000408f87 in myarray<double>::~myarray (this=0x7ffe173923f0, __in_chrg=<optimized out>) at src/../include/myarray.h:240
    240	  delete[] cpu_data;
    (gdb) list
    235	// destructor
    236
    237	template <typename T>
    238	myarray<T>::~myarray()
    239	{
    240	  delete[] cpu_data;
    241	  // do we need to deallocate gpu memory here as well?
    242	}
    243
    244	// #### methods ####
    (gdb) print cpu_data
    $1 = (double *) 0x3fd00e6251f20673
```
